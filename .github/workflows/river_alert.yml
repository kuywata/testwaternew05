name: River Alert

on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  alert:
    runs-on: ubuntu-latest
    env:
      CHROME_BIN: /usr/bin/google-chrome-stable
      CHROMEDRIVER_PATH: /usr/bin/chromedriver
      LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
      LINE_TARGET_ID: ${{ secrets.LINE_TARGET_ID }}
      NOTIFICATION_THRESHOLD_M: ${{ secrets.NOTIFICATION_THRESHOLD_M }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies (Chrome + Chromedriver)
        run: |
          sudo apt-get update

          # ติดตั้ง wget และ Chromedriver โดยไม่ดึง chromium-browser (snap) มา
          sudo apt-get install -y --no-install-recommends wget chromium-chromedriver

          # ดาวน์โหลดและติดตั้ง Google Chrome Stable (.deb ไม่ใช้ snap)
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt-get install -y ./google-chrome-stable_current_amd64.deb

          # ติดตั้ง Python requirements
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          fi

      - name: Run alert script
        run: python inburi_bridge_alert.py
